name: Generate GPT Context

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  generate-context:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create context markdown
        run: |
          mkdir -p docs
          echo "# 🧠 GPT Project Context" > docs/gpt_context.md
          echo "Generated at: $(date)" >> docs/gpt_context.md
          echo -e "\n## 📌 Summary" >> docs/gpt_context.md
          echo "- Project: onbit_v2_triple" >> docs/gpt_context.md
          echo "- Goal: AI 기반 코인 실시간 감시 및 자동화 시스템 구축" >> docs/gpt_context.md
          echo "- Structure: core / data / domain / presentation" >> docs/gpt_context.md
          echo "- Features: GPT + Claude + Groq 3자 협업, CI/CD, 실시간 스트림 등" >> docs/gpt_context.md
          echo -e "\n## 🔄 Recent Commits\n" >> docs/gpt_context.md
          git log --pretty=format:"- %s (%h)" -n 10 >> docs/gpt_context.md

      - name: Create context JSON
        run: |
          cat <<EOF > docs/gpt_context.json
          {
            "project": "onbit_v2_triple",
            "goal": "AI 기반 코인 실시간 감시 및 자동화 시스템 구축",
            "ai_architecture": ["GPT", "Claude", "Groq"],
            "structure": ["core", "data", "domain", "presentation"],
            "features": [
              "실시간 코인 분석",
              "3자 AI 협업 구조",
              "자동화 트레이딩",
              "CI/CD 워크플로우",
              "Code coverage + badge system"
            ],
            "generated_at": "$(date +%Y-%m-%dT%H:%M:%S)"
          }
EOF

      - name: Commit context files
        run: |
          git config --global user.name "onbit-bot"
          git config --global user.email "onbit-bot@users.noreply.github.com"
          git add docs/gpt_context.*
          git commit -m "docs: update GPT context in markdown and JSON" || echo "No changes to commit"
          git push
