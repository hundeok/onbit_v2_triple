name: Generate GPT Context

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  generate-context:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create context markdown
        run: |
          mkdir -p docs
          echo "# ğŸ§  GPT Project Context" > docs/gpt_context.md
          echo "Generated at: $(date)" >> docs/gpt_context.md
          echo -e "\n## ğŸ“Œ Summary" >> docs/gpt_context.md
          echo "- Project: onbit_v2_triple" >> docs/gpt_context.md
          echo "- Goal: AI ê¸°ë°˜ ì½”ì¸ ì‹¤ì‹œê°„ ê°ì‹œ ë° ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶•" >> docs/gpt_context.md
          echo "- Structure: core / data / domain / presentation" >> docs/gpt_context.md
          echo "- Features: GPT + Claude + Groq 3ì í˜‘ì—…, CI/CD, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ ë“±" >> docs/gpt_context.md
          echo -e "\n## ğŸ”„ Recent Commits\n" >> docs/gpt_context.md
          git log --pretty=format:"- %s (%h)" -n 10 >> docs/gpt_context.md

      - name: Create context JSON
        run: |
          cat <<EOF > docs/gpt_context.json
          {
            "project": "onbit_v2_triple",
            "goal": "AI ê¸°ë°˜ ì½”ì¸ ì‹¤ì‹œê°„ ê°ì‹œ ë° ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶•",
            "ai_architecture": ["GPT", "Claude", "Groq"],
            "structure": ["core", "data", "domain", "presentation"],
            "features": [
              "ì‹¤ì‹œê°„ ì½”ì¸ ë¶„ì„",
              "3ì AI í˜‘ì—… êµ¬ì¡°",
              "ìë™í™” íŠ¸ë ˆì´ë”©",
              "CI/CD ì›Œí¬í”Œë¡œìš°",
              "Code coverage + badge system"
            ],
            "generated_at": "$(date +%Y-%m-%dT%H:%M:%S)"
          }
EOF

      - name: Commit context files
        run: |
          git config --global user.name "onbit-bot"
          git config --global user.email "onbit-bot@users.noreply.github.com"
          git add docs/gpt_context.*
          git commit -m "docs: update GPT context in markdown and JSON" || echo "No changes to commit"
          git push
